{
  "all_procs": {
    "procedure_1.csv": "item,phasetype,max_time,text,shuffle_1,map_file,location_sheet,longitude_min,longitude_max,latitude_min,latitude_max,radar_radius,user_radius,\r\n2,geo_location,user,This is the start of a new experiment.,off,../User/Projects/5aside/big_pitch.jpg,locations.csv,-0.95047,-0.95192,51.44249,51.44301,10px,2px,\r\n2,geo_location,user,This is the start of a new experiment.,off,../User/Projects/5aside/big_pitch.jpg,locations.csv,-0.95456,-0.95462,51.45056,51.45057,10px,2px,"
  },
  "conditions": "name,notes,stimuli,procedure,fullscreen,welcome,participant_id,end_message,start_message,buffer,scripts,skip_quality,\r\ncondition_1,You can put more detailed notes in this field,stimuli_1.csv,procedure_1.csv,off,,off,,,5,,yes,",
  "all_stims": {
    "stimuli_1.csv": "cue,answer,\r\nA,Apple,\r\nB,Banana,\r\n,,",
    "locations.csv": "long,lat,btn_text,main_text,hidden,class,id,status,question,correct_answer,incorrect_answers,\r\n,,,,,,,,,,,"
  },
  "location": "biagi-haffey/geo-football/5aside",
  "public_key": "MXyPLK2HTTpr/7TNlrfszdvO8cK1XBK0B9PW7TsAGWQ=",
  "surveys": {},
  "trialtypes": {},
  "code": {
    "instruct": "<!--\n/*  Collector (Garcia, Kornell, Kerr, Blake & Haffey)\n    A program for running experiments on the web\n    Copyright 2012-2016 Mikey Garcia & Nate Kornell\n\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License version 3 as published by\n    the Free Software Foundation.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>\n \t\t\n\t\tKitten/Cat release (2019-2021) author: Dr. Anthony Haffey (team@someopen.solutions)\t\t\n*/\n-->\n<style>\n#instruct_text{\n  margin:auto;\n  width:500px;\n  padding:50px;\n  max-height:600px;\n  text-align: center;  \n}\n#proceed_button{\n  position:absolute;\n  right: 20px;\n}\n#trial_contents{\n  position: absolute;\n  top:0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  margin:auto;\n  width:600;\n  height:600;\n}\n</style>\n<div id=\"trial_contents\">\n  <div id=\"instruct_text\">{{text}}</div>\n  <div>\n    <button class=\"btn btn-primary\" id=\"proceed_button\" onclick=\"Phase.submit()\">Proceed</button>\n  </div>\n</div>",
    "geo_location": "<!DOCTYPE html>\r\n<html>\r\n<style>\r\n#your_location{\r\n  !background-color: blue;\r\n  border-radius: {{user_radius}};\r\n  width: {{user_radius}};\r\n  height: {{user_radius}};\r\n  position:absolute;\r\n  animation: pulse 2s infinite;\r\n}\r\n#detection_radius{\r\n  border-radius: {{radar_radius}};\r\n  border-width:5px !important;\r\n  width:  {{radar_radius}};\r\n  height: {{radar_radius}};\r\n  position:absolute;\r\n  background-color:blue;\r\n  opacity: 0.5;\r\n}\r\n\r\n.pulsate {\r\n  animation: pulse 2s infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n\t0% {\r\n\t\ttransform: scale(0.5);\r\n\t\t!box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7);\r\n\t\t!border-radius: 50%;\r\n\t}\r\n\r\n\t70% {\r\n\t\ttransform: scale(1);\r\n\t\t!box-shadow: 0 0 0 10px rgba(0, 0, 0, 0);\r\n\t\t!border-radius: 50%;\r\n\t}\r\n\r\n\t100% {\r\n\t\ttransform: scale(0.5);\r\n\t\t!box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);\r\n\t\t!border-radius: 50%;\r\n\t}\r\n}\r\n#campus_map{\r\n  width:900px;\r\n  height:900px;\r\n}\r\n</style>\r\n<body>\r\n\r\n<img id=\"campus_map\" src=\"{{map_file}}\"/>\r\n\r\n<div id=\"detection_radius\" class=\"border border-primary\"></div>\r\n<div id=\"your_location\" class=\"bg-primary\"></div>\r\n<div id=\"lat_long\"></div>\r\n<button id=\"move_up\">Up</button>\r\n<button id=\"move_down\">Down</button>\r\n<button id=\"move_right\">right</button>\r\n<button id=\"move_left\">Left</button>\r\n<button id=\"show_locations\">show all locations</button>\r\n\r\n<p id=\"demo\"></p>\r\n\r\n<script>\r\nvar pilot_object = {\r\n  down: 0,\r\n  right: 0\r\n}\r\n\r\n$(\"#move_up\").on(\"click\",function(){\r\n  pilot_object.down -= 50;\r\n});\r\n$(\"#move_down\").on(\"click\",function(){\r\n  pilot_object.down += 50;\r\n});\r\n$(\"#move_left\").on(\"click\",function(){\r\n  pilot_object.right -= 50;\r\n});\r\n$(\"#move_right\").on(\"click\",function(){\r\n  pilot_object.right += 50;\r\n});\r\n\r\n\r\n\r\nfunction center_coords(x_pos,y_pos,element){\r\n  var element_width  = element.css(\"width\").replace(\"px\",\"\");\r\n  var element_height = element.css(\"height\").replace(\"px\",\"\");\r\n  element.css(\"left\", x_pos - element_width/2);\r\n  element.css(\"top\", y_pos - element_height/2);\r\n}\r\n\r\n//https://stackoverflow.com/a/23339967\r\nfunction collidesWith (element1, element2) {\r\n  var Element1 = {};\r\n  var Element2 = {};\r\n\r\n  Element1.top = $(element1).offset().top;\r\n  Element1.left = $(element1).offset().left;\r\n  Element1.right = Number($(element1).offset().left) + Number($(element1).width());\r\n  Element1.bottom = Number($(element1).offset().top) + Number($(element1).height());\r\n\r\n  Element2.top = $(element2).offset().top;\r\n  Element2.left = $(element2).offset().left;\r\n  Element2.right = Number($(element2).offset().left) + Number($(element2).width());\r\n  Element2.bottom = Number($(element2).offset().top) + Number($(element2).height());\r\n\r\n  if (Element1.right > Element2.left && Element1.left < Element2.right && Element1.top < Element2.bottom && Element1.bottom > Element2.top) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\n\r\n\r\n//https://www.openstreetmap.org/ is useful for getting coordinates and images\r\nvar x_range = [{{longitude_min}},{{longitude_max}}];\r\nvar y_range = [{{latitude_min}},{{latitude_max}}];\r\nvar x_width = x_range[1] - x_range[0];\r\nvar y_width = y_range[1] - y_range[0];\r\n\r\nvar stimuli_locations = parent.parent.Collector.PapaParsed(Phase.get_stim(\"{{location_sheet}}\"));\r\nconsole.log(\"stimuli_locations\");\r\nconsole.log(stimuli_locations);\r\n\r\n\r\nfunction x_y_positions(longitude, latitude){\r\n  var x_pos = parseFloat($(\"#campus_map\").css(\"width\").replace(\"px\",\"\")) * (longitude - x_range[0])/x_width\r\n  var y_pos = parseFloat($(\"#campus_map\").css(\"height\").replace(\"px\",\"\")) * (1-(latitude - y_range[0])/y_width)\r\n  return [x_pos,y_pos];\r\n}\r\n\r\n\r\nstimuli_locations.forEach(function(this_location, index){\r\n  location_element = $(\"<button>\");\r\n  location_element.html(\"?\")\r\n    .addClass(\"btn\")\r\n    .addClass(\"btn-secondary\")\r\n    .addClass(\"location\")\r\n    .prop(\"id\",this_location.id)\r\n    .prop(\"disabled\",true)\r\n    .css(\"position\", \"absolute\");\r\n    \r\n  if(this_location.hidden == \"yes\"){\r\n    location_element.css(\"display\", \"none\");\r\n  }\r\n  if(this_location.class !== \"\"){\r\n    location_element.addClass(this_location.class);\r\n  }\r\n  \r\n  $(document.body).append(location_element);\r\n  [x_pos,y_pos] = x_y_positions(this_location.long, this_location.lat);\r\n  center_coords(x_pos, y_pos, location_element);\r\n});\r\n\r\n$(\"#show_locations\").on(\"click\", function(){\r\n  $(\".location\").show();\r\n  $(\".location\").removeClass(\"btn-secondary\", false);\r\n  $(\".location\").addClass(\"btn-primary\", false);\r\n  $(\".location\").prop(\"disabled\", false);\r\n});\r\n\r\n$(\".location\").on(\"click\", function(){\r\n  var this_row = stimuli_locations.filter(row => row.id == $(this)[0].id)[0];\r\n  bootbox.alert(this_row.main_text);\r\n})\r\n\r\nfunction detect_location(x_pos, y_pos){\r\n  stimuli_locations.forEach(function(this_location, index){\r\n    if(collidesWith($(\"#detection_radius\")[0], $(\"#\" + this_location.id)[0])){\r\n      $(\"#\" + this_location.id).html(this_location[\"btn_text\"]);\r\n      $(\"#\" + this_location.id).removeClass(\"btn-secondary\", false);\r\n      $(\"#\" + this_location.id).addClass(\"btn-primary\", false);\r\n      $(\"#\" + this_location.id).prop(\"disabled\", false);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getLocation() {\r\n  console.log(navigator);\r\n  if (navigator.geolocation) {\r\n    navigator.geolocation.getCurrentPosition(function(position){\r\n      [x_pos,y_pos] = x_y_positions(position.coords.longitude, position.coords.latitude);\r\n      x_pos += pilot_object.right;\r\n      y_pos += pilot_object.down;\r\n  \r\n      \r\n      center_coords(x_pos,y_pos, $(\"#your_location\"));\r\n      center_coords(x_pos,y_pos, $(\"#detection_radius\"));\r\n      \r\n      detect_location(x_pos, y_pos);\r\n      $(\"#lat_long\").html(position.coords.latitude + \"-\" + position.coords.longitude);\r\n      \r\n      \r\n    }, function(error){\r\n      //[x_pos,y_pos] = x_y_positions(position.coords.longitude, position.coords.latitude);\r\n      \r\n      var x_pos = parseFloat($(\"#campus_map\").css(\"width\").replace(\"px\",\"\")) * .5 + pilot_object.right;\r\n      var y_pos = parseFloat($(\"#campus_map\").css(\"height\").replace(\"px\",\"\")) * .5 + pilot_object.down;\r\n      \r\n      center_coords(x_pos,y_pos, $(\"#your_location\"));\r\n      center_coords(x_pos,y_pos, $(\"#detection_radius\"));\r\n      \r\n      detect_location(x_pos, y_pos);\r\n      $(\"#lat_long\").html(x_pos + \"-\" + y_pos);\r\n      \r\n      console.log(\"error:\" + error.message);\r\n    });\r\n  } else { \r\n    x.innerHTML = \"Geolocation is not supported by this browser.\";\r\n  }\r\n}\r\n\r\ngetLocation();\r\nlocation_interval = setInterval(function(){\r\n  getLocation();\r\n},5000);\r\n</script>\r\n\r\n</body>\r\n</html>"
  },
  "phasetypes": {
    "geo_location": "[[[LOCATION]]]../User/PhaseTypes/geo_location.html"
  },
  "procs_csv": {},
  "stims_csv": {}
}